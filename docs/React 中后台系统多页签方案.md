---
password: ''
icon: ''
åˆ›å»ºæ—¶é—´: '2023-04-07T19:15:00.000Z'
date: '2021-10-12 00:00:00'
type: Post
slug: peqmq8
é…ç½®ç±»å‹:
  type: string
  string: æ–‡æ¡£
summary: æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ª React ä¸­åå°ç³»ç»Ÿå¤šé¡µç­¾æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ ‡ç­¾é¡µåŠŸèƒ½ã€é¡µé¢æ•°æ®ç¼“å­˜ã€æƒé™ç›¸å…³ç­‰åŠŸèƒ½ç‚¹ã€‚åŒæ—¶ï¼Œè¿˜æ¶‰åŠåˆ°è·¯ç”±ç»“æ„å’Œ Layout å¸ƒå±€ç»„ä»¶ç­‰æ–¹é¢çš„é—®é¢˜ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©è¯»è€…ç†è§£å¤šé¡µç­¾å®ç°çš„åŸç†åŠå…¶åº”ç”¨åœºæ™¯ã€‚
æ›´æ–°æ—¶é—´: '2023-08-26T15:22:00.000Z'
title: React ä¸­åå°ç³»ç»Ÿå¤šé¡µç­¾æ–¹æ¡ˆ
category: æŠ€æœ¯åˆ†äº«
tags:
  - React
status: Archived
urlname: aea49f8c-44b2-44d5-a269-c0d1ff23625d
updated: '2023-08-26 23:22:00'
---

# å¼•è¨€


åœ¨ä¸­åå°ç®¡ç†ç±»ç³»ç»Ÿä¸­ï¼Œ**å¤šé¡µç­¾**çš„éœ€æ±‚éå¸¸æ™®éï¼Œç”¨æˆ·å¸¸å¸¸éœ€è¦åœ¨å¤šä¸ªé¡µç­¾å†…è·³è½¬ï¼Œæ¯”å¦‚å¡«å†™è¡¨å•æ—¶å»æŸ¥è¯¢æŸä¸ªåˆ—è¡¨è·å–ä¸€äº›å­—æ®µä¿¡æ¯å†å›åˆ°è¡¨å•é¡µé¢å¡«å†™ã€‚è¿™æ ·çš„éœ€æ±‚åœ¨ Vue ä¸­ä½¿ç”¨ [keep-alive](https://v3.cn.vuejs.org/api/built-in-components.html#keep-alive) å³å¯å®ç°ï¼Œä½†æ˜¯åœ¨ React ä¸­ï¼ŒReact Router åˆ‡æ¢è·¯ç”±åå°±ä¼šå¸è½½ç»„ä»¶ï¼Œè€Œæœ¬èº«å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼ keep-alive çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ç°å¤šé¡µç­¾çš„åŠŸèƒ½å°±ä¼šå˜å¾—æ ¼å¤–å›°éš¾ã€‚æˆ‘çš„é¡¹ç›®ä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æŠ€æœ¯è°ƒç ”å’ŒæŠ€æœ¯é€‰å‹çš„è¿‡ç¨‹ã€‚


React å¤šé¡µç­¾ UI æœ¬èº«å¥½å®ç°ï¼Œéš¾ç‚¹æ˜¯æ²¡æœ‰å®˜æ–¹æä¾›ç±»ä¼¼ Vue çš„ keep-alive åŠŸèƒ½ï¼Œè€Œä½¿ç”¨ React Routerï¼Œè·¯ç”±åˆ‡æ¢ä¼šç›´æ¥å¸è½½ç»„ä»¶ï¼Œå¯¼è‡´æ— æ³•ç¼“å­˜ï¼Œç”¨æˆ·çš„æ•°æ®å’Œè¡Œä¸ºå› æ­¤ä¸¢å¤±äº†ã€‚


ç¤¾åŒºä¸Šå…³äºå¤šé¡µç­¾çš„éœ€æ±‚å‘¼å£°ä¹Ÿéå¸¸é«˜ï¼Œä½†æ˜¯å¦‚ React ç¤¾åŒºæ¯”è¾ƒå‡ºåçš„ä¸­åå°æ–¹æ¡ˆ[Ant Design Pro](https://github.com/ant-design/ant-design-pro)ä¹Ÿä¸æ”¯æŒè¯¥åŠŸèƒ½ï¼Œè‡³ä»Šä»ç„¶æœ‰å¾ˆå¤š[Issue](https://github.com/ant-design/ant-design-pro/issues?q=%E5%A4%9A%E9%A1%B5%E7%AD%BE%E9%9C%80%E6%B1%82)æå‡ºè¿™ç±»éœ€æ±‚ï¼š


![FuCO9hJ-9X7b-OFn_NHjdjHcbZoU.png](https://image.1874.cool/1874-blog-images/c0c040e9fa554f9f3d458ed0201aed26.png)


[åå³](https://github.com/afc163)å¤§ä½¬æ—©åœ¨ 2017 å¹´å¯¹æ­¤åšå‡ºäº†å›åº”ï¼Œè¯¦è§[èƒ½å¦æä¾› tab åˆ‡æ¢æ¨¡å¼ Â· Issue #220 Â· ant-design/ant-design-pro Â· GitHub](https://github.com/ant-design/ant-design-pro/issues/220)ï¼Œè¿™ä¸ª Issue è™½ç„¶å…³é—­äº†ï¼Œä½†è¿™äº›å¹´ä»ç„¶æ´»è·ƒï¼š


![FvCuqsZHkUWinokfvz1NcpDwc5Id.png](https://image.1874.cool/1874-blog-images/d6deb04ca839c57a45325ff55a72d874.png)


çœ‹ ğŸ‘ çš„æ•°é‡å°±çŸ¥é“ï¼Œç”¨æˆ·å…¶å®å¯¹è¿™ç§å›ç­”å¾ˆä¸ä¹°å¸ã€‚å†æ¥çœ‹ 2019 å¹´åå³å¯¹è¿™ä¸ªé—®é¢˜çš„è§£é‡Šï¼Œç¨å¾®å…·ä½“äº†äº›ï¼š


![FofX-2QeIqDSJCDnMrh_wshVNfkp.png](https://image.1874.cool/1874-blog-images/f9f84c9d813b6d7556243e9663b31792.png)


# é¡¹ç›®ç®€ä»‹


æ‰€åœ¨éƒ¨é—¨çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå°ç¨‹åºå‘å¸ƒå¹³å°çš„ç®¡ç†åå°ï¼Œç”¨äºç§Ÿæˆ·å°ç¨‹åºçš„ä»£ç æäº¤ã€æå®¡ã€å‘å¸ƒç­‰å·¥ä½œæµã€‚å‰ç«¯å®¢æˆ·ç«¯æ˜¯ React 16.13.1ï¼ŒBFF å±‚åˆ™æ˜¯ Koa2 çš„ Node ç«¯ï¼Œåç«¯åˆ™æ˜¯ Goã€‚


# éœ€æ±‚èƒŒæ™¯


å› ä¸ºå¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜ä¼šç»å¸¸å¯¹å°ç¨‹åºè¿›è¡ŒæŸ¥è¯¢ã€æäº¤ä»£ç ã€ä½“éªŒç­‰ç­‰æ“ä½œï¼Œæœ‰ä¸¤ä¸ªç—›ç‚¹å¾ˆæ˜æ˜¾ï¼š

1. åˆ—è¡¨æŸ¥è¯¢çš„æœç´¢æ¡ä»¶ä¼šå› ä¸ºåˆ‡æ¢è·¯ç”±è€Œæ¶ˆå¤±ï¼Œç‰¹åˆ«æ˜¯æœ‰äº›ç­›é€‰æ¡ä»¶æ˜¯ä»æ•°æ®åº“æ‹¿çš„ï¼Œä¼šåœ¨æ•°æ®åº“å’Œç½‘é¡µä¹‹é—´æ¥å›å¤åˆ¶ç²˜è´´ï¼Œæµªè´¹æ—¶é—´ã€‚
2. å¯¹äºæµ‹è¯•äººå‘˜å’Œå¼€å‘äººå‘˜æ¥è¯´ï¼Œæµè§ˆå™¨çš„æ ‡ç­¾é¡µç»å¸¸ä¼šå¼€å¾ˆå¤šï¼Œå¦‚æœæˆ‘æƒ³å¤šæ“ä½œå‡ ä¸ªå°ç¨‹åºï¼Œåˆ™éœ€è¦åˆå¤šå¼€æµè§ˆå™¨çš„æ ‡ç­¾é¡µè¿›è¡Œæ“ä½œï¼Œæœ¬æ¥å°±æ˜¯ SPA å•é¡µåº”ç”¨ï¼Œæ‰€æœ‰çš„æ“ä½œåº”è¯¥å°½é‡åœ¨ä¸€ä¸ªé¡µé¢ä¸Šå®Œæˆã€‚

# æ–¹æ¡ˆé€‰å‹


ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼ŒåŸºæœ¬çš„æ€è·¯å¤§æ¦‚æœ‰ä¸‰ç§ï¼š

1. ä½¿ç”¨ Reduxï¼Œæ•°æ®å¾€ store é‡Œé¢æ€¼ï¼Œå®ç°é¡µé¢æ•°æ®çš„â€ç¼“å­˜â€œã€‚
2. æ”¹å†™ React Router æºç ï¼Œåˆ‡æ¢è·¯ç”±ä¸å¸è½½ï¼Œæ”¹ä¸ºéšè—ã€‚
3. ä½¿ç”¨ç¤¾åŒºçš„è½®å­ï¼Œå½“æ—¶é€‰äº† GitHub é‡Œçš„ä¸¤ä¸ªäº§å“ï¼š [React Keeper](https://github.com/lanistor/react-keeper) å’Œ [react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)

å…¶å®æ¯ç§æ–¹æ¡ˆéƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæœ€ç»ˆçš„é€‰æ‹©æ˜¯ä½¿ç”¨äº†æ’é™¤æ³•ã€‚
ç¬¬ä¸€ç§æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯ï¼Œé¡¹ç›®æœ¬èº«çš„æ¥å…¥ Redux çš„æ“ä½œç¹çï¼Œæ”¹é€ ä¾µå…¥æ€§æ¯”è¾ƒå¤§ï¼Œä¸æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚
ç¬¬äºŒç§çš„æ€è·¯å’Œ [react-router-cache-route](https://github.com/CJY0208/react-router-cache-route) æ¯”è¾ƒåƒï¼Œå°±ä¸æƒ³é‡å¤é€ è½®å­äº†ã€‚
ç¬¬ä¸‰ç§é€‰ç”¨å¼€æºæ–¹æ¡ˆï¼Œç”¨ç¤¾åŒºçš„ä¼˜ç§€è½®å­ï¼š[react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)


ç»“åˆç›®å‰é¡¹ç›®çš„æƒ…å†µï¼Œä¸æƒ³æ”¹åŠ¨ç‚¹å¤ªå¤šï¼Œæ‰€ä»¥é€‰æ‹©äº†å¼€æºæ–¹æ¡ˆ [react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)


# æ–¹æ¡ˆå®æ–½


å¤šæ ‡ç­¾é¡µéœ€æ±‚å¯ä»¥æ‹†åˆ†ä¸ºä¸¤æ­¥ï¼š

1. å®ç°é¡µé¢æ•°æ®çš„ç¼“å­˜
2. èœå•è·¯ç”±ç»“åˆå¤šæ ‡ç­¾ ui

## ä½¿ç”¨[react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)å®ç°é¡µé¢çš„æ•°æ®ç¼“å­˜


é¦–å…ˆé‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ç›®å‰çš„é¡¹ç›®ä¸­ï¼Œè·¯ç”±ç”¨çš„æ˜¯é…ç½®æ˜¯è·¯ç”±ï¼Œå³é€šè¿‡[react-router-config](https://github.com/ReactTraining/react-router)ä¸­çš„`renderRoutes`å°†é…ç½®å¼è·¯ç”±è¿›è¡Œè½¬æ¢ï¼š


```javascript
function renderRoutes(routes, extraProps, switchProps) {
  if (extraProps === void 0) {
    extraProps = {};
  }

  if (switchProps === void 0) {
    switchProps = {};
  }
  // å°†é…ç½®å¼è·¯ç”±ç”Ÿæˆå£°æ˜å¼è·¯ç”±ï¼Œç”Ÿæˆ
  // <Switch>
  // 		<Route path={} exact={}></Route>
  // </Switch>
  return routes
    ? React.createElement(
        Switch,
        switchProps,
        routes.map(function (route, i) {
          return React.createElement(Route, {
            key: route.key || i,
            path: route.path,
            exact: route.exact,
            strict: route.strict,
            render: function render(props) {
              return route.render
                ? route.render(
                    _extends({}, props, {}, extraProps, {
                      route: route,
                    })
                  )
                : React.createElement(
                    route.component,
                    _extends({}, props, extraProps, {
                      route: route,
                    })
                  );
            },
          });
        })
      )
    : null;
}

```


è€Œ[react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)ç›®å‰ä¸æ”¯æŒé…ç½®å¼è·¯ç”±ã€‚


![Ft59aRxMoSdz4eMGTfBLOXfG3xGx.png](https://image.1874.cool/1874-blog-images/26a9e6deaa84f20ca57833c2d1f07601.png)


æ‰€ä»¥å°±éœ€è¦å¯¹`renderRoutes`æ–¹æ³•è¿›è¡Œæ”¹é€ ï¼Œåœ¨ç”Ÿæˆè·¯ç”±æ—¶ï¼Œç”¨ä»–æä¾›çš„ CacheRoute æ›¿æ¢ Routeï¼Œç”¨ CacheSwitch æ›¿æ¢ Switchã€‚


```javascript
import React from "react";
import CacheRoute, { CacheSwitch } from "react-router-cache-route";

// é‡å†™react-router-configä¸­çš„renderRoutesæ–¹æ³•
// å°†react-router-domä¸­çš„Switchå’ŒRouteç»„ä»¶æ›¿æ¢ä¸ºreact-router-cache-routeä¸­çš„CacheSwitchå’ŒCacheRouteç»„ä»¶
// ç”¨äºç»„ä»¶çš„ç¼“å­˜ï¼Œåˆ©ç”¨react-router-cache-routeè½®å­ï¼Œåœ¨åˆ‡æ¢è·¯ç”±æ—¶ä¸è®©ç»„ä»¶å¸è½½ï¼Œè€Œæ˜¯éšè—
export const renderRoutes = (routes, extraProps = {}, switchProps = {}) => {
  return routes
    ? React.createElement(
        CacheSwitch,
        switchProps,
        routes.map(function (route, i) {
          return React.createElement(CacheRoute, {
            key: route.key || i,
            path: route.path,
            exact: route.exact,
            strict: route.strict,
            render: function render(props) {
              return route.render
                ? route.render({ ...props, ...extraProps, route: route })
                : React.createElement(route.component, {
                    ...props,
                    ...extraProps,
                    route: route,
                  });
            },
          });
        })
      )
    : null;
};

```


## èœå•è·¯ç”±ç»“åˆå¤šæ ‡ç­¾ ui


ui çš„é€»è¾‘å‚è€ƒçš„æ˜¯[react-antd-multi-tabs-admin](https://github.com/hsl947/react-antd-multi-tabs-admin)ã€‚


### UI ç•Œé¢


![FkGiH4KxP7eKbIfUMnPhEcx9n1Ml.png](https://image.1874.cool/1874-blog-images/6321a9264dafc5eb308def2ca33d2510.png)


### åŠŸèƒ½ç‚¹

1. æ ¹æ®å·¦ä¾§èœå•æ ç”Ÿæˆå¯¹åº”çš„ Tab æ ‡ç­¾
2. å³é”®å¯ä»¥åˆ·æ–°ã€å…³é—­ã€å…³é—­å…¶ä»–ã€å…³é—­å…¨éƒ¨
3. Tab æ ‡ç­¾é¡µæœ¬èº«å¯ä»¥å…³é—­ï¼Œå…³é—­åè‡ªåŠ¨åˆ‡æ¢åˆ°å·²æ‰“å¼€çš„æ ‡ç­¾é¡µ
4. åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ä¿æŒåŸæœ‰çš„æ•°æ®ä¸ä¼šé‡æ–°åŠ è½½

### æ€è€ƒ


### æ•°æ®å­˜å‚¨


ç”¨ store å­˜å‚¨æ ‡ç­¾é¡µæ•°æ®ã€‚Tab æ ‡ç­¾é¡µæ˜¯ä¸€ä¸ªå…¨å±€å…±äº«ï¼Œè€ƒè™‘åˆ°æ•°æ®å…±äº«çš„é—®é¢˜ï¼Œå°†æ•°æ®å­˜å‚¨åˆ° store ä¸­ï¼Œå¹¶åœ¨æ¯ä¸ªé¡µé¢å…±äº«ã€‚


> å¯ä»¥è€ƒè™‘æŠŠå½“å‰æ‰“å¼€çš„æ ‡ç­¾æ•°æ®åŒæ­¥è‡³ localstory ä¸­ï¼Œå®ç°åˆ·æ–°åä¾ç„¶å¯ä»¥æ¢å¤å·²æ‰“å¼€çš„æ ‡ç­¾é¡µï¼Œä½†æ˜¯ç›®å‰æ„Ÿè§‰æ¯”è¾ƒé¸¡è‚‹ï¼Œåªæœ‰æŠŠè¡¨å•æ•°æ®ä¸€èµ·åŒæ­¥æ‰æœ‰å®ç”¨ä»·å€¼ã€‚


### èœå•å’Œ Tab é¡µåŒæ­¥


å› ä¸º url å·²ç»å’Œèœå•é¡µåŒæ­¥ï¼Œæ‰€ä»¥è·å–å½“å‰èœå•æœ€æ–¹ä¾¿çš„æ–¹å¼å°±æ˜¯ä» url ä¸­è·å–å½“å‰çš„è·¯ç”±ï¼Œç„¶åç”Ÿæˆæ ‡ç­¾é¡µï¼Œå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œç›´æ¥ç”¨ history.push çš„æ–¹å¼æ”¹å˜ urlï¼Œæ­¤æ—¶èœå•é¡µä¹Ÿä¼šè·Ÿç€å˜ã€‚


## å®æ–½


### æ–°å»º tabPanes.tsx


```typescript
import React, {
  FC,
  useState,
  useEffect,
  useRef,
  useCallback,
  Component,
} from "react";
import { useHistory, useLocation } from "react-router-dom";
import { Tabs, Alert, Dropdown, Menu } from "antd";
import Home from "@pages/miniapps";
import { getKeyName } from "@utils/routerUtils";
import { SyncOutlined } from "@ant-design/icons";
import { useSelector } from "react-redux";
import style from "./index.module.less";
import { CommonObjectType, RefType } from "@type/type";
import { useActions } from "@utils/hook";
import { RootState } from "@reducers/index";

const { TabPane } = Tabs;

const initPane = [
  {
    title: "ä»£ç ç®¡ç†",
    key: "miniapps",
    content: Home,
    closable: false,
    path: "/miniapps",
  },
];

interface Props {
  // é»˜è®¤æ¿€æ´»çš„Tabé¡µ
  defaultActiveKey: string;
  // æ ‡ç­¾é¡µçš„props
  panesItem: {
    title: string;
    content: Component;
    key: string;
    closable: boolean;
    path: string;
  };
  // æ¿€æ´»çš„æ ‡ç­¾é¡µ
  tabActiveKey: string;
}

// å¤šé¡µç­¾ç»„ä»¶
const TabPanes: FC<Props> = (props) => {
  // è®°å½•å½“å‰æ¿€æ´»çš„Tabé¡µ
  const [activeKey, setActiveKey] = useState<string>("");
  // è®°å½•å½“å‰æ‰“å¼€çš„Tabé¡µ
  const [panes, setPanes] = useState<CommonObjectType[]>(initPane);
  // è®°å½•Tabé¡µçš„åˆ·æ–°çŠ¶æ€
  const [isReload, setIsReload] = useState<boolean>(false);
  // è®°å½•å½“å‰å³é”®é€‰ä¸­çš„Tabé¡µ
  const [selectedPanel, setSelectedPanel] = useState<CommonObjectType>({});
  // ç”¨useRefè®°å½•æœ€æ–°çš„Tabé¡µæ•°æ®
  const pathRef: RefType = useRef<string>("");

  // å–å‡ºæ“ä½œTabé¡µçš„action
  const { layouts } = useActions(["layouts"]);
  // ä»storeå–å‡ºå½“å‰çš„Tabé¡µåˆ—è¡¨å’Œåˆ·æ–°è·¯å¾„
  const { curTab, reloadPath } = useSelector(
    (state: RootState) => state.layouts
  );

  // å–å‡ºprops
  const { defaultActiveKey, panesItem, tabActiveKey } = props;
  // ç”¨historyè¿›è¡Œè·³è½¬ï¼Œç»“åˆreact-router-cache-routeä¼šå°†æ•°æ®è¿›è¡Œç¼“å­˜
  const history = useHistory();
  // å–å‡ºå½“å‰çš„pathï¼Œä¾‹å¦‚/miniapps /logç­‰
  const { pathname, search } = useLocation();
  // å¯èƒ½ä¼šæœ‰å¸¦å‚æ•°çš„æƒ…å†µ
  const fullPath = pathname + search;

  // è®°å½•å½“å‰æ‰“å¼€çš„tab
  const storeTabs = useCallback((ps): void => {
    // å¯¹è·¯å¾„è¿›è¡Œç´¯åŠ ï¼Œå¯¹å½“å‰æ‰“å¼€çš„è·¯å¾„è¿›è¡Œå…¨å­˜å‚¨
    const pathArr = ps.reduce(
      (prev: CommonObjectType[], next: CommonObjectType) => [
        ...prev,
        next.path,
      ],
      []
    );
    // å°†æ•°æ®è®°å½•åˆ°storeä¸­
    layouts.setTab(pathArr);
  }, []);

  // ä»æœ¬åœ°å­˜å‚¨ä¸­æ¢å¤å·²æ‰“å¼€çš„tabåˆ—è¡¨
  const initTabs = useCallback((): void => {
    const initPanes = curTab.reduce(
      (prev: CommonObjectType[], next: string) => {
        const { title, tabKey, component: Content } = getKeyName(next);
        return [
          ...prev,
          {
            title,
            key: tabKey,
            content: Content,
            closable: tabKey !== "/miniapps",
            path: next,
          },
        ];
      },
      []
    );
    // ä»è·¯ç”±ä¸­è·å–å½“å‰éœ€è¦æ‰“å¼€çš„Tabé¡µ
    const { tabKey } = getKeyName(pathname);
    // è®¾ç½®å½“å‰æ‰“å¼€çš„Tabé¡µ
    setPanes(initPanes);
    // è®¾ç½®å½“å‰æ¿€æ´»çš„Tabé¡µ
    setActiveKey(tabKey);
  }, [pathname]);

  // åˆå§‹åŒ–é¡µé¢
  useEffect(() => {
    initTabs();
  }, [initTabs]);

  // tabåˆ‡æ¢
  const onChange = (tabKey: string): void => {
    setActiveKey(tabKey);
  };

  // ç§»é™¤tab
  const remove = (targetKey: string): void => {
    const delIndex = panes.findIndex((item: any) => item.key === targetKey);
    panes.splice(delIndex, 1);

    // åˆ é™¤éå½“å‰tab
    if (targetKey !== activeKey) {
      const nextKey = activeKey;
      setPanes(panes);
      setActiveKey(nextKey);
      storeTabs(panes);
      return;
    }

    // åˆ é™¤å½“å‰tabï¼Œåœ°å€å¾€å‰æ¨ï¼Œå¦‚æœå‰é¢æ²¡æœ‰tabé¡µå°±å¾€åæ¨
    const nextPath = curTab[delIndex - 1] || curTab[delIndex + 1];
    history.push(nextPath);
    // è®°å½•åˆ é™¤åçš„Tabé¡µ
    setPanes(panes);
    // å°†æ•°æ®è®°å½•åˆ°store
    storeTabs(panes);
  };

  // tabç‚¹å‡»åˆ é™¤æ“ä½œ
  const onEdit = (targetKey: string | any, action: string) =>
    action === "remove" && remove(targetKey);

  // tabç‚¹å‡»ï¼Œæ¿€æ´»æ ‡ç­¾é¡µ
  const onTabClick = (targetKey: string): void => {
    const { path } = panes.filter(
      (item: CommonObjectType) => item.key === targetKey
    )[0];
    history.push({ pathname: path });
  };

  // åˆ·æ–°å½“å‰ tab
  const refreshTab = (): void => {
    setIsReload(true);
    setTimeout(() => {
      setIsReload(false);
    }, 1000);

    layouts.reloadTab(pathname + search);
    setTimeout(() => {
      layouts.reloadTab("null");
    }, 500);
  };

  // å…³é—­å…¶ä»–æˆ–å…³é—­æ‰€æœ‰
  const removeAll = async (isCloseAll?: boolean) => {
    const { path, key } = selectedPanel;
    console.log("selectedPanel", path, key);
    // å…³é—­æ‰€æœ‰å°±è·³è½¬åˆ°ä»£ç ç®¡ç†
    // å…³é—­å…¶ä»–å°±è·³è½¬åˆ°å³é”®é€‰æ‹©çš„tabé¡µä¸Š
    // æƒ…å†µä¸€ï¼šåœ¨å½“å‰æ¿€æ´»çš„tabé¡µæ“ä½œå…³é—­å…¶ä»–ï¼Œåˆ™ä¼šä¿ç•™å½“å‰çš„tabé¡µï¼›
    // æƒ…å†µäºŒï¼šåœ¨å…¶ä»–æœªæ¿€æ´»çš„Tabé¡µæ“ä½œå…³é—­å…¶ä»–ï¼Œåˆ™ä¼šè·³è½¬åˆ°é¼ æ ‡æ“ä½œçš„tabé¡µ
    history.push(isCloseAll ? "/miniapps" : path);

    // å½“å‰å·²æ‰“å¼€çš„tabé¡µ
    // å¦‚æœå³é”®æ“ä½œçš„ä¸æ˜¯ä»£ç ç®¡ç†é¡µï¼ˆminiappsï¼‰ï¼Œä¸”é€‰æ‹©çš„æ˜¯å…³é—­å…¶ä»–ï¼Œåˆ™å½“å‰æ‰“å¼€çš„Tabé¡µæ˜¯ä»£ç ç®¡ç†é¡µ+ å³é”®ç‚¹å‡»æ‰€åœ¨çš„é¡µé¢
    // å¦åˆ™ï¼šå¦‚æœå³é”®æ“ä½œçš„æ˜¯ä»£ç ç®¡ç†é¡µï¼ˆminiappsï¼‰ï¼Œæˆ–è€…é€‰æ‹©çš„æ˜¯å…³é—­æ‰€æœ‰ï¼Œåˆ™å½“å‰æ‰“å¼€çš„Tabé¡µæ˜¯ä»£ç ç®¡ç†é¡µ
    const nowPanes =
      key !== "/miniapps" && !isCloseAll
        ? [...initPane, selectedPanel]
        : initPane;
    setPanes(nowPanes);
    // å¦‚æœæ˜¯å…³é—­å…¨éƒ¨ï¼Œå°±è·³è½¬åˆ°ä»£ç ç®¡ç†é¡µ
    setActiveKey(isCloseAll ? "/miniapps" : key);
    storeTabs(nowPanes);
  };

  useEffect(() => {
    const newPath = pathname + search;

    // å½“å‰çš„è·¯ç”±å’Œä¸Šä¸€æ¬¡çš„ä¸€æ ·ï¼Œreturn
    if (!panesItem.path || panesItem.path === pathRef.current) return;

    // ä¿å­˜è¿™æ¬¡çš„è·¯ç”±åœ°å€
    pathRef.current = newPath;
  });

  useEffect(() => {
    const index = panes.findIndex((_: CommonObjectType) => {
      return _.key === panesItem.key;
    });
    // æ— æ•ˆçš„æ–°tabï¼Œreturn
    if (
      !panesItem.key ||
      (index > -1 && pathRef.current === panes[index].path)
    ) {
      setActiveKey(tabActiveKey);
      return;
    }

    // æ–°tabå·²å­˜åœ¨ï¼Œé‡æ–°è¦†ç›–æ‰ï¼ˆè§£å†³å¸¦å‚æ•°åœ°å€æ•°æ®é”™ä¹±é—®é¢˜ï¼‰
    if (index > -1) {
      panes[index].path = pathRef.current;
      setPanes(panes);
      setActiveKey(tabActiveKey);
      return;
    }
    // æ·»åŠ æ–°tabå¹¶ä¿å­˜èµ·æ¥
    panes.push(panesItem);
    setPanes(panes);
    setActiveKey(tabActiveKey);
    storeTabs(panes);
  }, [panes]);

  const isDisabled = () => selectedPanel.key === "/miniapps";
  // tabå³å‡»èœå•
  const menu = (
    <Menu>
      <Menu.Item
        key="1"
        onClick={() => refreshTab()}
        disabled={selectedPanel.path !== fullPath}
      >
        åˆ·æ–°
      </Menu.Item>
      <Menu.Item
        key="2"
        onClick={(e) => {
          e.domEvent.stopPropagation();
          remove(selectedPanel.key);
        }}
        disabled={isDisabled()}
      >
        å…³é—­
      </Menu.Item>
      <Menu.Item
        key="3"
        onClick={(e) => {
          e.domEvent.stopPropagation();
          removeAll();
        }}
      >
        å…³é—­å…¶ä»–
      </Menu.Item>
      <Menu.Item
        key="4"
        onClick={(e) => {
          e.domEvent.stopPropagation();
          removeAll(true);
        }}
        disabled={isDisabled()}
      >
        å…¨éƒ¨å…³é—­
      </Menu.Item>
    </Menu>
  );

  const onRightClick = (e: CommonObjectType, panel: object) => {
    e.preventDefault();
    setSelectedPanel(panel);
  };

  return (
    <div>
      <Tabs
        activeKey={activeKey}
        className={style.tabs}
        defaultActiveKey={defaultActiveKey}
        hideAdd
        onChange={onChange}
        onEdit={onEdit}
        onTabClick={onTabClick}
        type="editable-card"
      >
        {panes.map((pane: CommonObjectType) => (
          <TabPane
            closable={pane.closable}
            key={pane.key}
            tab={
              <Dropdown
                overlay={menu}
                placement="bottomLeft"
                trigger={["contextMenu"]}
              >
                <span onContextMenu={(e) => onRightClick(e, pane)}>
                  {isReload &&
                    pane.path === fullPath &&
                    pane.path !== "/401" && (
                      <SyncOutlined title="åˆ·æ–°" spin={isReload} />
                    )}
                  {pane.title}
                </span>
              </Dropdown>
            }
          >
            {reloadPath !== pane.path ? (
              <pane.content path={pane.path} />
            ) : (
              <div style={{ height: "100vh" }}>
                <Alert message="åˆ·æ–°ä¸­..." type="info" />
              </div>
            )}
          </TabPane>
        ))}
      </Tabs>
    </div>
  );
};

export default TabPanes;

```


### æ–°å»º useTabActive è‡ªå®šä¹‰ Hook


```typescript
const noNewTab = ["/login", "/"]; // ä¸éœ€è¦æ–°å»º tabçš„é¡µé¢
interface PanesItemProps {
  title: string;
  content: Component;
  key: string;
  closable: boolean;
  path: string;
}

export const useTabActive = () => {
  const { pathname, search } = useLocation();
  const [panesItem, setPanesItem] = useState<PanesItemProps>({
    title: "",
    // @ts-ignore
    content: null,
    key: "",
    closable: false,
    path: "",
  });
  const pathRef: RefType = useRef<string>("");
  const [tabActiveKey, setTabActiveKey] = useState<string>("miniapps");

  useEffect(() => {
    // è®°å½•æ ‡ç­¾é¡µ
    const { tabKey, title, component: Content } = getKeyName(pathname);
    // æ–°tabå·²å­˜åœ¨æˆ–ä¸éœ€è¦æ–°å»ºtabï¼Œreturn
    if (pathname === pathRef.current || noNewTab.includes(pathname)) {
      setTabActiveKey(tabKey);
      return;
    }
    // è®°å½•æ–°çš„è·¯å¾„ï¼Œç”¨äºä¸‹æ¬¡æ›´æ–°æ¯”è¾ƒ
    const newPath = search ? pathname + search : pathname;
    pathRef.current = newPath;
    setPanesItem({
      title,
      content: Content,
      key: tabKey,
      closable: tabKey !== "/miniapps",
      path: newPath,
    });
    setTabActiveKey(tabKey);
  }, [pathname]);

  return { panesItem, tabActiveKey };
};

```


### å°†åŸæ¥çš„ content å†…å®¹ç»„ä»¶è¿›è¡Œæ›¿æ¢


```typescript
const { panesItem, tabActiveKey } = useTabActive()

<Layout.Content>
  <TabPanes
    defaultActiveKey="miniapps"
    panesItem={panesItem}
    tabActiveKey={tabActiveKey}
   />
</Layout.Content>

```


# é—®é¢˜


## routes è·¯ç”±é‡å¤æ¸²æŸ“


```typescript
import React, { useEffect } from "react";
import {
  BrowserRouter as Router,
  Switch,
  Route,
  Redirect,
} from "react-router-dom";
import { RouteConfigComponentProps } from "react-router-config";
import { renderRoutes } from "@utils/routerUtils";
import config from "@utils/config";
import { useDispatch } from "react-redux";
import Layout from "@layouts/default";
import Autho from "@components/autho";
import NotFined from "@components/errorPage/404";
import { useActions } from "@utils/hook";

// åˆå¹¶è·¯ç”±
const routes = [
  ...require("@pages/manager_develop/router").default,
  ...require("@pages/miniapps/router").default,
  ...require("@pages/templates/router").default,
  ...require("@pages/log/router").default,
  ...require("@pages/dashboard/router").default,
  ...require("@pages/operations/router").default,
  { path: "*", exact: true, component: NotFined },
];

const loginRoute = require("@pages/login/router").default;

type RouteComponentType = React.ComponentType<RouteConfigComponentProps<any>>;

const Root: RouteComponentType = function (props) {
  const dispatch = useDispatch();
  // å–å‡ºæ“ä½œTabé¡µçš„action
  const { layouts } = useActions(["layouts"]);
  window.router = props;
  window.dispatch = dispatch;

  if (!props.route) {
    return null;
  }
  // @ts-ignore
  if (props.pathname === "/") {
    window.router.history.push(config.homeUrl);
    layouts.setTab(["/miniapps"]);
  }
  // ï¼ˆ1ï¼‰è¿™é‡Œæ¸²æŸ“äº†ä¸€æ¬¡
  return renderRoutes(props.route.routes);
};

export const rootRoutes = [
  {
    component: Root,
    path: "/",
    name: "é¦–é¡µ",
    routes: [
      ...loginRoute,
      {
        // ï¼ˆ2ï¼‰è¿™é‡Œæ¸²æŸ“äº†ä¸€æ¬¡
        component: (props) => (
          <Layout key="root_layout">
            {props.route && renderRoutes(props.route.routes)}
          </Layout>
        ),
        routes: [
          ...routes.map((item) => ({
            ...item,
            component: () => {
              const C = item.component;
              return (
                <Autho block="nav" funcCode={item.menuCode}>
                  <C />
                </Autho>
              );
            },
          })),
        ],
      },
    ],
  },
];

const RouterMap = () => {
  return (
    <Router basename={config.routerBaseName}>
      {/* (3)è¿™é‡Œæ¸²æŸ“äº†ä¸€æ¬¡*/}
      {renderRoutes(rootRoutes)}
    </Router>
  );
};

export default RouterMap;

```


è¿™é‡Œä¸€å…±åœ¨ä¸‰ä¸ªåœ°æ–¹è°ƒç”¨äº†`renderRoutes(rootRoutes)`è¿›è¡Œäº†ç»„ä»¶æ¸²æŸ“ï¼Œè€Œä¸”`rootRoutes`çš„ç»“æ„æ¯”è¾ƒè¯¡å¼‚ï¼š


```json
[
  {
    path: "/",
    name: "é¦–é¡µ",
    routes: [
      {
        path: "/login",
        exact: true,
      },
      {
        routes: [
          {
            path: "/operations/error",
            exact: true,
            name: "é”™è¯¯æ—¥å¿—",
            menuCode: "error",
          },
          {
            path: "/operations/errorinfo",
            name: "é”™è¯¯è¯¦æƒ…",
            menuCode: "errorinfo",
            exact: true,
          },
          {
            path: "/operations/performance",
            name: "æ€§èƒ½ç›‘æ§",
            menuCode: "performance",
            exact: true,
          },
          {
            path: "*",
            exact: true,
          },
        ],
      },
    ],
  },
];

```


å‚è€ƒ cms çš„è·¯ç”±ç»“æ„ï¼š


```json
[
  {
    routes: [
      {
        path: "/",
        exact: true,
      },
      {
        path: "/register_customer",
        name: "customer",
        title: "é›†å›¢å®¢æˆ·",
        exact: true,
      },
      {
        path: "/region_customer",
        name: "customer",
        title: "åŒºåŸŸå®¢æˆ·",
        exact: true,
      },
      {
        path: "/user_project_visit",
        name: "customer",
        title: "é¡¹ç›®å®¢æˆ·",
        exact: true,
      },
      {
        path: "*",
        exact: true,
      },
    ],
  },
];

```


æˆ–è€…å¦ä¸€ç§åµŒå¥—ç»“æ„ï¼š


```json
[
  {
    path: "/",
    name: "é¦–é¡µ",
    routes: [
      {
        path: "/operations/error",
        exact: true,
        name: "é”™è¯¯æ—¥å¿—",
        menuCode: "error",
      },
      {
        path: "/operations/errorinfo",
        name: "é”™è¯¯è¯¦æƒ…",
        menuCode: "errorinfo",
        exact: true,
      },
      {
        path: "/operations/performance",
        name: "æ€§èƒ½ç›‘æ§",
        menuCode: "performance",
        exact: true,
      },
      {
        path: "*",
        exact: true,
      },
    ],
  },
];

```


## Layout å¸ƒå±€ç»„ä»¶è€¦åˆä¸¥é‡


```typescript
<Layout style={{ minHeight: "100vh", height: "100%", overflow: "hidden" }}>
  <Sider
    collapsible
    collapsed={collapsed}
    onCollapse={setCollapsed}
    style={{ position: "fixed", zIndex: 100, height: "100%" }}
  >
    <div style={{ display: "flex", padding: 16 }}>
      {platforms.length && (
        <Select
          onSelect={(id) => {
            select({ ...platforms.find((item) => item.component_id === id) });
          }}
          defaultValue={component_id}
          className={styles.env}
        >
          {platforms.map((opt) => (
            <Select.Option
              key={opt.component_id}
              value={opt.component_id}
              title={opt.component_name}
            >
              {opt.component_name}
            </Select.Option>
          ))}
        </Select>
      )}
      <LogoutOutlined onClick={logout} className={styles.logut} />
    </div>
    {renderMenu()}
  </Sider>
  <Layout style={{ marginLeft: collapsed ? "80px" : "200px" }}>
    <Layout.Content>
      <TabPanes
        defaultActiveKey="miniapps"
        panesItem={panesItem}
        tabActiveKey={tabActiveKey}
      />
    </Layout.Content>
    <Footer style={{ textAlign: "center" }}>Copyright Â©</Footer>
  </Layout>
</Layout>

```


å¯ä»¥çœ‹åˆ°ï¼Œå¸ƒå±€ç»„ä»¶åµŒå¥—äº†åŒ…æ‹¬å°ç¨‹åºå¹³å°çš„ä¸šåŠ¡ç»„ä»¶é€»è¾‘ï¼Œæˆ‘è¿™æ¬¡ä¹ŸæŠŠ Tab ç»„ä»¶åµŒå¥—è¿›å»äº†ï¼Œè€¦åˆæœ‰ç‚¹å¼ºï¼Œåç»­ç»´æŠ¤æˆæœ¬é«˜ï¼Œåé¢è€ƒè™‘ä»è·¯ç”±å‡ºå‘ï¼Œé‡æ–°æ¢³ç†ä¸‹ç»“æ„ã€‚
å¯¹æ¯” cms çš„å¸ƒå±€ç»„ä»¶ï¼Œå°±å…·æœ‰ç›¸å¯¹é«˜çš„é€šç”¨æ€§


```typescript
<div
  className="common-layout-default"
  style={{ background: props.bgColor || "#fff" }}
>
  <Header></Header>
  <div
    className="common-layouts-side-styles"
    style={{ maxWidth: props.maxWidth, minWidth: props.minWidth }}
  >
    <div className="layout-side">
      <SideNavigation></SideNavigation>
    </div>
    <div className="layout-content">{props.children}</div>
  </div>
  <Footer></Footer>
</div>

```


# éœ€è¦æµ‹è¯•çš„åŠŸèƒ½ç‚¹


![FkGiH4KxP7eKbIfUMnPhEcx9n1Ml.png](https://image.1874.cool/1874-blog-images/6321a9264dafc5eb308def2ca33d2510.png)


## ç™»å½•ç›¸å…³

- ç›´æ¥è¾“å…¥.../login è¿›è¡Œç™»å½•åæ ‡ç­¾é¡µåŠŸèƒ½
- æ­£å¸¸é€€å‡ºåé‡æ–°ç™»å½•åæ ‡ç­¾é¡µåŠŸèƒ½

## æƒé™ç›¸å…³

- æ— é¡µé¢æƒé™æ—¶çš„æ ‡ç­¾é¡µåŠŸèƒ½
- ç›®å‰è·¯ç”±å’Œæ ‡ç­¾é¡µæ˜¯å…¨åŒ¹é…æ–°å»ºçš„ï¼Œåªæœ‰å½“è·¯ç”±å®Œå…¨ä¸€è‡´æ—¶æ‰ä¼šæ–°å»ºæ ‡ç­¾é¡µï¼Œå¦åˆ™ä¼šæ˜¾ç¤ºæ— æƒé™ï¼Œä¾‹å¦‚`.../p-yunke-ai-third-platform/operations/error`å’Œ`.../p-yunke-ai-third-platform/operations/error/`ï¼Œå¤šäº†ä¸€ä¸ª`/`éƒ½ä¸è¡Œ

## æ ‡ç­¾é¡µåŠŸèƒ½


é»˜è®¤ä»£ç ç®¡ç†é¡µé¢ä¸ºé»˜è®¤é¡µé¢ï¼Œæ— æ³•å…³é—­ã€‚

- æ–°å¢æ ‡ç­¾é¡µ

	> ç‚¹å‡»å·¦ä¾§èœå•ï¼Œå¦‚æœæ‰“å¼€çš„æ˜¯ä¸åŒçš„é¡µé¢ï¼Œåˆ™ä¼šæ–°å»º tab

- å…³é—­æ ‡ç­¾é¡µ
- åˆ·æ–°å½“å‰é¡µ

	> åªæœ‰åœ¨å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µæ‰èƒ½è¿›è¡Œåˆ·æ–°é¡µé¢çš„æ“ä½œ

- å…³é—­å…¶å®ƒæ ‡ç­¾
- å…³é—­å…¨éƒ¨æ ‡ç­¾

	> è§„åˆ™ï¼šåœ¨å½“å‰å·²æ‰“å¼€çš„ tab é¡µï¼Œ å¦‚æœå³é”®æ“ä½œçš„ä¸æ˜¯ä»£ç ç®¡ç†é¡µï¼ˆminiappsï¼‰ï¼Œä¸”é€‰æ‹©çš„æ˜¯å…³é—­å…¶ä»–ï¼Œåˆ™å½“å‰æ‰“å¼€çš„ Tab é¡µæ˜¯ä»£ç ç®¡ç†é¡µ+ å³é”®ç‚¹å‡»æ‰€åœ¨çš„é¡µé¢  
	> å¦åˆ™ï¼šå¦‚æœå³é”®æ“ä½œçš„æ˜¯ä»£ç ç®¡ç†é¡µï¼ˆminiappsï¼‰ï¼Œæˆ–è€…é€‰æ‹©çš„æ˜¯å…³é—­æ‰€æœ‰ï¼Œåˆ™å½“å‰ä¿ç•™çš„ Tab é¡µæ˜¯ä»£ç ç®¡ç†é¡µ


## é¡µé¢æ•°æ®ç¼“å­˜


ç›®å‰æ”¯æŒåœ¨ä¸åŒæ ‡ç­¾é¡µåˆ‡æ¢æ—¶ä¸ä¼šæ¸…ç©ºè¡¨å•æ•°æ®ï¼Œä½†æ˜¯åˆ·æ–°ä¾ç„¶ä¼šæ¸…ç©ºï¼ˆä»£ç ç®¡ç†é¡µé¢é™¤å¤–ï¼Œå•ç‹¬åšäº†åˆ·æ–°åä¾æ—§å¯ä»¥ç¼“å­˜æ•°æ®ï¼‰

